# 架构与项目结构

本文整合原 `架构图.md` 与 `项目结构.md` 的关键信息。

## 总体架构

- UI 层：PowerShell CLI、WPF GUI（WinUI 3 已移除）
- 核心层：`MigrationCore`（Models + Services）
- 系统层：Windows API（robocopy、mklink、P/Invoke）

## MVVM 分层（WPF）

- View：`MoveWithSymlinkWPF/MainWindow.xaml`
- ViewModel：`MoveWithSymlinkWPF/ViewModels/MainViewModel.cs`
- Model/Services：`MigrationCore/*`

## 迁移六步流程

1) 路径验证 → 2) 扫描源目录 → 3) 复制文件 → 4) 创建符号链接 → 5) 健康检查 → 6) 清理备份

## 核心服务与模型

- `MigrationService`：执行完整迁移流程（进度、日志、回滚）
- `PathValidator`：路径合法性、管理员权限、磁盘空间
- `FileStatsService`：统计文件数/大小/大文件，格式化字节
- `SymbolicLinkHelper`：创建/验证目录符号链接
- `MigrationConfig` / `MigrationProgress` / `MigrationResult` / `FileStats`

## 项目结构（简）

```
moveFloder/
├── MigrationCore/
│   ├── Models/
│   └── Services/
├── MoveWithSymlinkWPF/
│   ├── ViewModels/
│   ├── Converters/
│   └── Properties/PublishProfiles/
├── MoveWithSymlink.ps1
├── publish.ps1
└── run.ps1
```

## 图示（摘要）

- 序列图：ViewModel → MigrationService → PathValidator/FileStatsService/SymbolicLinkHelper → 结果
- 类图：`MigrationService` 依赖四个服务与四个模型，UI 通过 `IProgress<T>` 接收进度与日志

---

# 项目结构说明

## 目录树

```
MoveWithSymlink/
│
├── MoveWithSymlink.sln              # Visual Studio 解决方案文件
├── .gitignore                       # Git 忽略文件配置
├── build.ps1                        # 构建脚本
├── README.md                        # 英文文档
├── 需求说明.md                      # 原始需求文档
├── 使用说明.md                      # 中文使用说明
├── 项目结构.md                      # 本文件
│
├── MoveWithSymlink.ps1              # PowerShell CLI 版本（原始实现）
│
├── MigrationCore/                   # 核心业务逻辑类库
│   ├── MigrationCore.csproj         # 项目文件
│   │
│   ├── Models/                      # 数据模型
│   │   ├── MigrationConfig.cs       # 迁移配置参数
│   │   ├── FileStats.cs             # 文件统计信息
│   │   ├── MigrationProgress.cs     # 迁移进度信息
│   │   └── MigrationResult.cs       # 迁移结果
│   │
│   └── Services/                    # 服务层
│       ├── MigrationService.cs      # 核心迁移服务（主要逻辑）
│       ├── PathValidator.cs         # 路径验证服务
│       ├── FileStatsService.cs      # 文件统计服务
│       └── SymbolicLinkHelper.cs    # 符号链接操作辅助类
│
└── MoveWithSymlinkGUI/              # WinUI 3 GUI 应用
    ├── MoveWithSymlinkGUI.csproj    # 项目文件
    ├── app.manifest                 # 应用清单（管理员权限配置）
    ├── Program.cs                   # 应用程序入口点
    │
    ├── App.xaml                     # 应用程序资源定义
    ├── App.xaml.cs                  # 应用程序代码后台
    │
    ├── MainWindow.xaml              # 主窗口界面（XAML）
    ├── MainWindow.xaml.cs           # 主窗口代码后台
    │
    ├── ViewModels/                  # 视图模型（MVVM 模式）
    │   └── MainViewModel.cs         # 主视图模型（业务逻辑）
    │
    ├── Converters/                  # XAML 值转换器
    │   ├── BoolConverters.cs        # 布尔值转换器
    │   └── StepVisibilityConverter.cs # 步骤可见性转换器
    │
    ├── Assets/                      # 应用资源（图标、图片等）
    │   └── .gitkeep
    │
    └── Properties/                  # 项目属性
        ├── launchSettings.json      # 启动配置
        └── PublishProfiles/         # 发布配置
            └── win-x64.pubxml       # x64 发布配置
```

## 核心文件说明

### 1. 解决方案级别

| 文件 | 说明 |
|------|------|
| `MoveWithSymlink.sln` | Visual Studio 解决方案，包含两个项目 |
| `build.ps1` | 一键构建脚本 |
| `MoveWithSymlink.ps1` | PowerShell CLI 原始实现 |

### 2. MigrationCore 项目（核心库）

#### Models（数据模型）

| 文件 | 说明 |
|------|------|
| `MigrationConfig.cs` | 迁移配置参数（源/目标路径、线程数等） |
| `FileStats.cs` | 文件统计信息（文件数、总大小、大文件数） |
| `MigrationProgress.cs` | 进度信息（百分比、速度、ETA） |
| `MigrationResult.cs` | 迁移结果（成功/失败、错误信息） |

#### Services（服务层）

| 文件 | 说明 | 主要方法 |
|------|------|----------|
| `MigrationService.cs` | **核心迁移服务** | `ExecuteMigrationAsync()` - 执行完整迁移流程 |
| `PathValidator.cs` | 路径验证服务 | `ValidateSourcePath()`, `ValidateTargetPath()`, `ValidatePathRelation()` |
| `FileStatsService.cs` | 文件统计服务 | `ScanDirectoryAsync()`, `GetDirectorySize()`, `FormatBytes()` |
| `SymbolicLinkHelper.cs` | 符号链接操作 | `CreateDirectorySymbolicLink()`, `IsSymbolicLink()` |

### 3. MoveWithSymlinkGUI 项目（GUI 应用）

#### 应用程序核心

| 文件 | 说明 |
|------|------|
| `Program.cs` | 应用入口点，初始化 COM 包装和调度队列 |
| `App.xaml` | 应用资源定义（转换器、样式等） |
| `App.xaml.cs` | 应用代码，创建主窗口 |
| `app.manifest` | 应用清单，配置管理员权限和 DPI 感知 |

#### 界面

| 文件 | 说明 |
|------|------|
| `MainWindow.xaml` | 主窗口 XAML 界面定义（4 步向导） |
| `MainWindow.xaml.cs` | 主窗口代码后台，绑定 ViewModel |

#### ViewModels（MVVM）

| 文件 | 说明 | 主要属性/命令 |
|------|------|--------------|
| `MainViewModel.cs` | 主视图模型 | 属性: `SourcePath`, `TargetPath`, `CurrentStep`, `ProgressPercent` 等<br>命令: `BrowseSourceCommand`, `ValidateAndProceedCommand`, `StartMigrationCommand` 等 |

#### Converters（转换器）

| 文件 | 说明 |
|------|------|
| `BoolConverters.cs` | 布尔值转换器（4个）：<br>- `BoolToVisibilityConverter`<br>- `InverseBoolToVisibilityConverter`<br>- `InverseBoolConverter`<br>- `StringToBoolConverter` |
| `StepVisibilityConverter.cs` | 步骤可见性转换器（控制向导步骤显示） |

## 技术架构

### 设计模式

- **分层架构**: 核心库（MigrationCore）与 UI 层（MoveWithSymlinkGUI）分离
- **MVVM 模式**: GUI 使用 Model-View-ViewModel 架构
- **命令模式**: 使用 `ICommand` 和 `RelayCommand`（CommunityToolkit.Mvvm）
- **进度报告**: 使用 `IProgress<T>` 接口异步报告进度

### 依赖关系

```
MoveWithSymlinkGUI
    │
    ├── 引用 MigrationCore（核心逻辑）
    │
    ├── 依赖 Microsoft.WindowsAppSDK 1.5+（WinUI 3）
    │
    └── 依赖 CommunityToolkit.Mvvm 8.2+（MVVM 框架）
```

### 数据流

```
用户输入（XAML）
    ↓
MainViewModel（数据绑定）
    ↓
MigrationService（核心逻辑）
    ↓
PathValidator / FileStatsService / SymbolicLinkHelper（具体服务）
    ↓
Windows API（robocopy / mklink / P/Invoke）
```

## 关键功能模块

### 1. 路径验证模块（PathValidator）

- ✅ 阻止系统关键目录
- ⚠️ 警告云盘同步目录
- ✅ 检查路径关系（不能相同、不能互为子目录）
- ✅ 检查管理员权限
- ✅ 检查磁盘空间

### 2. 文件统计模块（FileStatsService）

- 📁 统计文件总数
- 💾 统计总大小
- 📦 统计大文件数量
- 📊 格式化字节显示
- ⚡ 异步扫描，支持取消

### 3. 迁移执行模块（MigrationService）

**6 个阶段**:
1. 路径解析与验证
2. 扫描源目录
3. 复制文件（robocopy）
4. 创建符号链接
5. 健康检查
6. 清理备份

**特性**:
- ✅ 实时进度报告
- ✅ 详细日志输出
- ✅ 自动回滚机制
- ✅ 支持取消操作

### 4. 符号链接模块（SymbolicLinkHelper）

- 方法 1: P/Invoke `CreateSymbolicLink`（推荐）
- 方法 2: 调用 `cmd mklink`（备选）
- ✅ 检查重解析点（验证符号链接）

## 界面结构（GUI）

### 4 步向导

```
┌─────────────────────────────────────┐
│  步骤导航栏（左侧）                    │
│  ○ 1. 选择路径                       │
│  ○ 2. 扫描分析                       │
│  ○ 3. 执行迁移                       │
│  ○ 4. 完成                           │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  步骤内容区（右侧）                    │
│                                      │
│  [步骤 1] 选择路径                    │
│  • 源目录输入框 + 浏览按钮             │
│  • 目标目录输入框 + 浏览按钮           │
│  • 高级选项（阈值、线程数）             │
│  • 验证信息提示                       │
│  • [下一步] 按钮                      │
│                                      │
│  [步骤 2] 扫描分析                    │
│  • 统计信息显示                       │
│  • [上一步] [开始扫描] 按钮            │
│                                      │
│  [步骤 3] 执行迁移                    │
│  • 阶段提示                          │
│  • 进度条                            │
│  • 实时日志窗口                       │
│  • [取消] [开始迁移] 按钮              │
│                                      │
│  [步骤 4] 完成                        │
│  • 成功/失败图标                      │
│  • 结果摘要                          │
│  • [完成] 按钮                        │
│                                      │
└─────────────────────────────────────┘
```

## 配置文件

### 项目配置（.csproj）

- **MigrationCore**: 纯类库，.NET 8.0 + Windows 10.0.19041
- **MoveWithSymlinkGUI**: WinExe，WinUI 3 应用

### 应用清单（app.manifest）

- 请求管理员权限: `requireAdministrator`
- DPI 感知: `PerMonitorV2`

## 编译输出

### Debug 构建
```
MoveWithSymlinkGUI\bin\x64\Debug\net8.0-windows10.0.19041.0\
├── MoveWithSymlinkGUI.exe
├── MigrationCore.dll
├── Microsoft.WindowsAppSDK.*.dll
└── ... (其他依赖)
```

### Release 构建
```
MoveWithSymlinkGUI\bin\x64\Release\net8.0-windows10.0.19041.0\
├── MoveWithSymlinkGUI.exe
├── MigrationCore.dll
└── ... (优化后的依赖)
```

## 扩展性设计

### 易于扩展的部分

1. **新增迁移策略**: 在 `MigrationService` 中添加新方法
2. **自定义验证规则**: 扩展 `PathValidator` 的阻止/警告列表
3. **新的文件操作**: 继承或扩展 `FileStatsService`
4. **UI 主题**: 修改 `App.xaml` 资源字典
5. **多语言支持**: 添加 `Resources.resx` 文件

### 建议的未来改进

- [ ] 添加哈希校验（MD5/SHA256）
- [ ] 批量迁移队列
- [ ] 过滤规则（排除特定文件/目录）
- [ ] 云盘同步暂停集成
- [ ] 结构化日志导出（JSON/CSV）
- [ ] 迁移历史记录
- [ ] 单元测试覆盖

## 相关文档

- **README.md**: 英文项目说明
- **使用说明.md**: 详细中文使用教程
- **需求说明.md**: 原始需求文档

---

**文档版本**: 1.0  
**更新日期**: 2024

---

# 系统架构图

## 总体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户界面层 (UI Layer)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────────┐         ┌──────────────────────┐    │
│  │  PowerShell CLI      │         │   WinUI 3 GUI        │    │
│  │  MoveWithSymlink.ps1 │         │ MoveWithSymlinkGUI   │    │
│  └──────────────────────┘         └──────────────────────┘    │
│            │                                 │                  │
│            │                                 │                  │
│            │         ┌───────────────────────┘                  │
│            │         │                                          │
└────────────┼─────────┼──────────────────────────────────────────┘
             │         │
             ▼         ▼
┌─────────────────────────────────────────────────────────────────┐
│                      业务逻辑层 (Business Layer)                  │
├─────────────────────────────────────────────────────────────────┤
│                        MigrationCore Library                     │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐    │
│  │                    Models (数据模型)                      │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │    │
│  │  │ Migration    │  │  File        │  │ Migration    │  │    │
│  │  │ Config       │  │  Stats       │  │ Progress     │  │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │    │
│  │         ┌──────────────┐                                │    │
│  │         │ Migration    │                                │    │
│  │         │ Result       │                                │    │
│  │         └──────────────┘                                │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐    │
│  │                   Services (服务层)                       │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │    │
│  │  │ Migration    │  │  Path        │  │ FileStats    │  │    │
│  │  │ Service      │  │  Validator   │  │ Service      │  │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │    │
│  │         ┌──────────────┐                                │    │
│  │         │ Symbolic     │                                │    │
│  │         │ LinkHelper   │                                │    │
│  │         └──────────────┘                                │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                  │
└──────────────────────────┬───────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────────┐
│                      系统调用层 (System Layer)                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │  Robocopy    │  │  P/Invoke    │  │   File       │         │
│  │  (复制文件)   │  │ CreateSymlink│  │   System     │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐                            │
│  │   cmd.exe    │  │   Windows    │                            │
│  │   mklink     │  │   API        │                            │
│  └──────────────┘  └──────────────┘                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## GUI 应用架构（MVVM）

```
┌─────────────────────────────────────────────────────────────────┐
│                          View (视图层)                            │
├─────────────────────────────────────────────────────────────────┤
│                         MainWindow.xaml                          │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │   步骤 1      │  │   步骤 2      │  │   步骤 3      │         │
│  │  选择路径     │  │  扫描分析     │  │  执行迁移     │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│         ┌──────────────┐                                        │
│         │   步骤 4      │                                        │
│         │    完成       │                                        │
│         └──────────────┘                                        │
│                                                                  │
└───────────────────────────┬──────────────────────────────────────┘
                            │ Data Binding (数据绑定)
                            │ Command Binding (命令绑定)
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                      ViewModel (视图模型层)                       │
├─────────────────────────────────────────────────────────────────┤
│                        MainViewModel.cs                          │
│                                                                  │
│  【属性 (Properties)】                                            │
│  • SourcePath, TargetPath                                       │
│  • CurrentStep, ProgressPercent                                 │
│  • LogMessages, StatsMessage                                    │
│  • IsValidating, IsScanning, IsMigrating                        │
│                                                                  │
│  【命令 (Commands)】                                              │
│  • BrowseSourceCommand, BrowseTargetCommand                     │
│  • ValidateAndProceedCommand                                    │
│  • ScanAndProceedCommand                                        │
│  • StartMigrationCommand, CancelMigrationCommand                │
│  • BackToStep1Command, BackToStep2Command, ResetCommand        │
│                                                                  │
└───────────────────────────┬──────────────────────────────────────┘
                            │ 调用服务
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Model (模型层 / 服务层)                      │
├─────────────────────────────────────────────────────────────────┤
│                       MigrationCore Library                      │
│                                                                  │
│  • MigrationService.ExecuteMigrationAsync()                     │
│  • PathValidator.ValidateSourcePath()                           │
│  • FileStatsService.ScanDirectoryAsync()                        │
│  • SymbolicLinkHelper.CreateDirectorySymbolicLink()             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 迁移流程图

```
                        ┌─────────────┐
                        │   开始      │
                        └──────┬──────┘
                               │
                        ┌──────▼──────┐
                        │ [阶段 1/6]  │
                        │ 路径解析验证 │
                        └──────┬──────┘
                               │
                    ┌──────────▼──────────┐
                    │ 检查源路径是否存在？  │
                    └──────┬──────┬───────┘
                           │ 是   │ 否
                           │      └─────────────┐
                    ┌──────▼──────┐            │
                    │ 验证目标路径 │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │ 检查路径关系 │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │ 检查权限/空间│            │
                    └──────┬──────┘            │
                           │                   │
                        ┌──▼──────┐            │
                        │ [阶段 2] │            │
                        │ 扫描源目录│            │
                        └──┬───────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │ 统计文件数量 │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │ 统计总大小   │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │ 统计大文件数 │            │
                    └──────┬──────┘            │
                           │                   │
                        ┌──▼──────┐            │
                        │ [阶段 3] │            │
                        │ 复制文件  │            │
                        └──┬───────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │启动 robocopy │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │监控复制进度  │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │验证复制完整性│            │
                    └──────┬──────┘            │
                           │                   │
                        ┌──▼──────┐            │
                        │ [阶段 4] │            │
                        │创建符号链接│           │
                        └──┬───────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │备份源目录    │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │创建 mklink   │            │
                    └──────┬──────┘            │
                           │                   │
                        ┌──▼──────┐            │
                        │ [阶段 5] │            │
                        │ 健康检查  │            │
                        └──┬───────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │验证重解析点  │            │
                    └──────┬──────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │测试链接访问  │            │
                    └──────┬──────┘            │
                           │                   │
                        ┌──▼──────┐            │
                        │ [阶段 6] │            │
                        │ 清理备份  │            │
                        └──┬───────┘            │
                           │                   │
                    ┌──────▼──────┐            │
                    │删除备份目录  │            │
                    └──────┬──────┘            │
                           │                   │
                        ┌──▼──────┐            │
                        │ 成功完成 │            │
                        └──────────┘            │
                                                │
                                         ┌──────▼──────┐
                                         │ 失败 - 回滚 │
                                         └──────┬──────┘
                                                │
                                         ┌──────▼──────┐
                                         │ 删除链接    │
                                         └──────┬──────┘
                                                │
                                         ┌──────▼──────┐
                                         │ 还原备份    │
                                         └──────┬──────┘
                                                │
                                         ┌──────▼──────┐
                                         │ 回滚完成    │
                                         └─────────────┘
```

---

## 数据流图

```
用户操作
    │
    ├─→ [选择源目录] ──→ SourcePath (属性)
    │
    ├─→ [选择目标目录] ──→ TargetPath (属性)
    │
    └─→ [开始迁移] ──→ StartMigrationCommand (命令)
                           │
                           ▼
                    创建 MigrationConfig
                           │
                           ▼
                    创建 MigrationService
                           │
                           ▼
                    ExecuteMigrationAsync()
                           │
            ┌──────────────┼──────────────┐
            │              │              │
            ▼              ▼              ▼
      Progress<        Progress<    CancellationToken
      Migration        string>
      Progress>
            │              │              │
            │              │              │
            ▼              ▼              │
    更新 UI 进度条    添加日志消息      │
    ProgressPercent   LogMessages        │
    ProgressMessage                      │
            │                             │
            └─────────────┬───────────────┘
                          │
                          ▼
                    MigrationResult
                          │
                ┌─────────┴─────────┐
                ▼                   ▼
            Success             Error
                │                   │
                ▼                   ▼
          显示成功结果         显示错误+回滚
```

---

## 类图（核心类关系）

```
┌─────────────────────────┐
│   MigrationConfig       │
│─────────────────────────│
│ + SourcePath            │
│ + TargetPath            │
│ + LargeFileThresholdMB  │
│ + RobocopyThreads       │
└───────────┬─────────────┘
            │ 配置
            ▼
┌─────────────────────────┐
│   MigrationService      │
│─────────────────────────│
│ - _config               │
│ - _backupPath           │
│─────────────────────────│
│ + ExecuteMigrationAsync()│
│ - ValidatePathsAsync()  │
│ - ScanSourceDirectory() │
│ - CopyFilesAsync()      │
│ - CreateSymbolicLink()  │
│ - VerifySymbolicLink()  │
│ - CleanupBackupAsync()  │
│ - RollbackAsync()       │
└───────┬─────────────────┘
        │ 使用
        │
        ├──────────────────────┐
        │                      │
        ▼                      ▼
┌─────────────────┐   ┌─────────────────┐
│ PathValidator   │   │ FileStatsService│
│─────────────────│   │─────────────────│
│ + Validate...() │   │ + ScanDirectory()│
│ + IsAdmin()     │   │ + GetDirSize()  │
│ + CheckSpace()  │   │ + FormatBytes() │
└─────────────────┘   └─────────────────┘
        │
        ▼
┌─────────────────────┐
│ SymbolicLinkHelper  │
│─────────────────────│
│ + CreateDirSymlink()│
│ + IsSymbolicLink()  │
└─────────────────────┘
```

---

## 组件交互序列图（迁移执行）

```
用户        ViewModel       MigrationService    PathValidator    FileStatsService    SymbolicLinkHelper
 │              │                   │                  │                 │                    │
 ├─点击"开始迁移"─→│                   │                  │                 │                    │
 │              ├─ExecuteAsync()───→│                  │                 │                    │
 │              │                   ├─ValidatePaths──→│                 │                    │
 │              │                   │←─────OK──────────┤                 │                    │
 │              │                   │                  │                 │                    │
 │              │                   ├─ScanDirectory────┼────────────────→│                    │
 │              │                   │←────Stats────────┼─────────────────┤                    │
 │              │                   │                  │                 │                    │
 │              │                   ├─CopyFiles()      │                 │                    │
 │              │                   │  (robocopy)      │                 │                    │
 │              │←────Progress──────┤                  │                 │                    │
 │←─更新进度条───┤                   │                  │                 │                    │
 │              │                   │                  │                 │                    │
 │              │                   ├─CreateSymlink────┼─────────────────┼───────────────────→│
 │              │                   │←─────OK──────────┼─────────────────┼────────────────────┤
 │              │                   │                  │                 │                    │
 │              │                   ├─VerifySymlink────┼─────────────────┼───────────────────→│
 │              │                   │←─────OK──────────┼─────────────────┼────────────────────┤
 │              │                   │                  │                 │                    │
 │              │                   ├─CleanupBackup()  │                 │                    │
 │              │                   │                  │                 │                    │
 │              │←────Result────────┤                  │                 │                    │
 │←─显示结果─────┤                   │                  │                 │                    │
 │              │                   │                  │                 │                    │
```
