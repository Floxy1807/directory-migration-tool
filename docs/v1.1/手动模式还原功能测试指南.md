# 手动模式还原功能测试指南

## 功能概述

手动模式现在支持还原功能：
- **迁移模式**：将普通目录迁移到新位置，原位置替换为符号链接
- **还原模式**：将符号链接还原为真实目录，撤销迁移操作

## 核心特性

### 1. 自动模式切换
- 选择源目录时自动检测是否为符号链接
- 如果是符号链接 → 自动切换为**还原模式**
- 如果是普通目录 → 保持**迁移模式**

### 2. 模式显示
- 每个步骤的右上角显示当前模式标签
  - 迁移模式：蓝色标签 "迁移模式"
  - 还原模式：橙色标签 "还原模式"

### 3. 还原模式特性
- 目标目录自动读取符号链接指向位置
- 目标目录输入框变为只读（灰色背景）
- 浏览按钮禁用
- 步骤3标题显示为"执行还原"
- 步骤4标题显示为"还原结果"

### 4. 还原后清理选项
- 还原成功后弹出对话框询问：**是否删除目标目录的数据？**
- 选择"是"：删除目标目录数据（节省空间）
- 选择"否"：保留目标目录数据（更安全）

## 测试场景

### 场景1：迁移模式测试

**前置条件**：准备一个测试目录（如 `C:\TestSource`）

**步骤**：
1. 打开应用，进入手动模式
2. 选择源目录：`C:\TestSource`
3. **验证**：右上角显示蓝色"迁移模式"标签
4. 选择目标目录：`D:\TestTarget`
5. **验证**：目标目录可以自由编辑和浏览
6. 点击"开始扫描"
7. **验证**：扫描页面右上角显示蓝色"迁移模式"标签
8. 点击"开始迁移"
9. **验证**：执行页面右上角显示蓝色"迁移模式"标签，标题为"执行迁移"
10. 等待迁移完成
11. **验证**：结果页面右上角显示蓝色"迁移模式"标签，标题为"迁移结果"
12. **验证**：`C:\TestSource` 变成符号链接，指向 `D:\TestTarget`

### 场景2：还原模式自动触发测试

**前置条件**：完成场景1，`C:\TestSource` 已是符号链接

**步骤**：
1. 关闭应用后重新打开，进入手动模式
2. 选择源目录：`C:\TestSource`（符号链接）
3. **验证**：右上角立即切换为橙色"还原模式"标签
4. **验证**：目标目录自动填充为 `D:\TestTarget`（符号链接指向）
5. **验证**：目标目录输入框变为灰色（只读），浏览按钮禁用
6. 点击"开始扫描"
7. **验证**：扫描页面右上角显示橙色"还原模式"标签
8. 点击"开始迁移"（实际执行还原）
9. **验证**：执行页面右上角显示橙色"还原模式"标签，标题为"执行还原"
10. 等待还原完成
11. **验证**：弹出对话框询问"是否删除目标目录的数据？"

### 场景3：还原后保留目标数据

**前置条件**：执行场景2到步骤11

**步骤**：
1. 在对话框中点击"否"（保留数据）
2. **验证**：结果页面显示"📁 已保留目标目录数据"
3. **验证**：`C:\TestSource` 恢复为真实目录
4. **验证**：`D:\TestTarget` 仍然存在且包含完整数据

### 场景4：还原后删除目标数据

**前置条件**：重新执行迁移，然后再次还原到对话框步骤

**步骤**：
1. 在对话框中点击"是"（删除数据）
2. **验证**：日志显示"正在删除目标目录数据..."
3. **验证**：结果页面显示"✅ 目标目录数据已删除"
4. **验证**：`C:\TestSource` 恢复为真实目录
5. **验证**：`D:\TestTarget` 已被删除

### 场景5：手动输入路径触发模式切换

**前置条件**：`C:\TestSource` 是符号链接

**步骤**：
1. 打开应用，进入手动模式
2. 手动在源目录输入框输入：`C:\TestSource`
3. **验证**：输入完成后，模式自动切换为橙色"还原模式"
4. **验证**：目标目录自动填充

## UI验证清单

- [ ] 步骤1：标题右侧显示模式标签
- [ ] 步骤2：标题右侧显示模式标签
- [ ] 步骤3：标题右侧显示模式标签
- [ ] 步骤4：标题右侧显示模式标签
- [ ] 迁移模式：蓝色背景 (#E3F2FD) + 深蓝文字 (#0078D4)
- [ ] 还原模式：橙色背景 (#FFF4E5) + 深橙文字 (#FF8C00)
- [ ] 还原模式下目标目录只读（灰色背景 #F5F5F5）
- [ ] 还原模式下浏览按钮禁用
- [ ] 目标目录标签动态显示："目标目录（迁移到的位置）" 或 "目标目录（符号链接指向）"
- [ ] 步骤3标题动态显示："执行迁移" 或 "执行还原"
- [ ] 步骤4标题动态显示："迁移结果" 或 "还原结果"

## 边界情况测试

### 边界1：普通目录与符号链接切换
**步骤**：
1. 先选择一个普通目录 → 验证迁移模式
2. 再选择一个符号链接目录 → 验证切换到还原模式
3. 再次选择普通目录 → 验证切换回迁移模式

### 边界2：无效路径处理
**步骤**：
1. 输入不存在的路径
2. **验证**：默认保持迁移模式
3. **验证**：验证步骤会捕获错误

### 边界3：符号链接指向不存在
**步骤**：
1. 创建一个指向不存在目录的符号链接
2. 选择该符号链接作为源目录
3. **验证**：切换到还原模式
4. **验证**：目标路径显示符号链接指向（即使不存在）

## 预期结果总结

✅ **成功标准**：
- 自动模式检测和切换正常工作
- UI显示正确（模式标签、只读状态、按钮状态）
- 还原功能正确执行（符号链接变回真实目录）
- 清理对话框正常弹出并按用户选择执行
- 所有步骤的模式标签始终显示正确
- 日志信息清晰准确

## 注意事项

1. **管理员权限**：确保以管理员身份运行应用，或启用开发者模式
2. **测试数据**：使用测试数据，避免操作重要文件
3. **磁盘空间**：确保目标磁盘有足够空间
4. **符号链接验证**：可使用 `dir /AL` 命令查看符号链接属性

