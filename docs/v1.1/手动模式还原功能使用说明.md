# 手动模式还原功能使用说明

## 功能简介

手动模式现在支持**还原功能**！您可以轻松地将已迁移的符号链接目录还原为原始的真实目录。

## 快速上手

### 迁移模式（原有功能）

当您选择一个**普通目录**作为源目录时，应用会自动进入迁移模式：

1. **选择源目录**：选择要迁移的普通目录
2. **选择目标目录**：选择迁移的目标位置
3. **开始扫描**：分析文件信息
4. **开始迁移**：执行迁移操作

**识别标志**：
- 右上角显示**蓝色**的"迁移模式"标签
- 目标目录可以自由编辑

### 还原模式（新功能）✨

当您选择一个**符号链接目录**作为源目录时，应用会自动进入还原模式：

1. **选择源目录**：选择要还原的符号链接目录
   - 应用会自动检测这是一个符号链接
   - 自动切换到还原模式
   - 自动读取并填充目标路径
2. **开始扫描**：分析要还原的数据
3. **开始还原**：执行还原操作
4. **选择清理方式**：还原成功后，选择是否删除目标目录数据

**识别标志**：
- 右上角显示**橙色**的"还原模式"标签
- 目标目录变为**灰色只读**（符号链接指向）
- 浏览按钮被禁用

## 详细使用步骤

### 场景：还原已迁移的目录

**前提**：您之前已经使用迁移功能将目录从 `C:\Games\MyGame` 迁移到了 `D:\Games\MyGame`，现在 `C:\Games\MyGame` 是一个符号链接。

**步骤**：

1. **打开应用，进入手动模式**
   
2. **选择源目录**
   - 点击"浏览..."按钮
   - 选择 `C:\Games\MyGame`（符号链接）
   - 或直接输入路径：`C:\Games\MyGame`

3. **自动切换模式**
   - 应用会自动检测这是一个符号链接
   - 界面右上角立即显示橙色的"**还原模式**"标签
   - 目标目录自动填充为：`D:\Games\MyGame`
   - 目标目录输入框变为灰色（只读）

4. **点击"开始扫描"**
   - 应用会扫描 `D:\Games\MyGame` 的数据
   - 评估磁盘空间需求

5. **点击"开始迁移"**
   - 实际执行的是还原操作
   - 进度条显示还原进度
   - 日志显示详细信息

6. **选择清理方式**
   - 还原成功后，弹出对话框询问：
   
   ```
   还原完成！
   
   是否删除目标目录的数据？
   
   目标目录：D:\Games\MyGame
   
   提示：删除后无法恢复。
   ```
   
   - **点击"是"**：
     - 删除 `D:\Games\MyGame` 的数据
     - 释放 D 盘空间
     - `C:\Games\MyGame` 恢复为真实目录
   
   - **点击"否"**：
     - 保留 `D:\Games\MyGame` 的数据作为备份
     - `C:\Games\MyGame` 恢复为真实目录
     - 两个位置都有完整数据

7. **查看结果**
   - 结果页面显示还原成功信息
   - 日志中记录了所有操作细节

## 视觉识别指南

### 迁移模式（蓝色）🔵
- **颜色**：蓝色标签
- **源目录**：普通目录
- **目标目录**：可编辑，白色背景
- **操作类型**：将普通目录迁移为符号链接

### 还原模式（橙色）🟠
- **颜色**：橙色标签
- **源目录**：符号链接
- **目标目录**：只读，灰色背景
- **操作类型**：将符号链接还原为真实目录

## 常见问题

### Q1：如何知道一个目录是否为符号链接？

**方法1**：使用本应用
- 选择该目录作为源目录
- 如果显示橙色"还原模式"标签，则是符号链接

**方法2**：使用命令行
```cmd
dir /AL "目录路径"
```
如果显示为 `<SYMLINKD>`，则是符号链接

**方法3**：查看属性
- 右键目录 → 属性
- 符号链接通常显示特殊图标（带箭头）

### Q2：还原后是否可以再次迁移？

可以！还原后，目录变回普通目录，您可以随时再次使用迁移功能。

### Q3：还原失败会怎样？

应用具有完善的回滚机制：
- 如果还原过程中出错，会自动回滚
- 符号链接保持不变
- 不会丢失任何数据

### Q4：应该选择保留还是删除目标数据？

**选择"保留"**：
- ✅ 更安全，有备份
- ❌ 占用双倍空间
- 推荐：重要数据或不确定时

**选择"删除"**：
- ✅ 释放磁盘空间
- ❌ 无法恢复
- 推荐：确定不需要备份时

### Q5：可以手动输入路径吗？

可以！手动输入路径后，应用会自动检测是否为符号链接并切换模式。

### Q6：还原需要多长时间？

还原时间取决于：
- 文件数量
- 文件大小
- 磁盘性能

通常比迁移快，因为是从较快的磁盘还原到原位置。

## 注意事项

1. **管理员权限**：还原操作需要管理员权限（或开发者模式）

2. **磁盘空间**：确保源磁盘有足够空间存放还原的数据

3. **使用中的文件**：还原前关闭正在使用该目录的程序

4. **目标数据**：选择删除目标数据前，请确认不需要该备份

5. **符号链接验证**：只有有效的符号链接才能进入还原模式

## 技巧与建议

💡 **先测试，后应用**
- 先用小目录测试还原功能
- 熟悉流程后再处理大型目录

💡 **保留备份一段时间**
- 首次还原后，建议先保留目标数据
- 确认一切正常后，再手动删除

💡 **查看日志**
- 每个步骤都有详细日志
- 遇到问题时，日志提供有价值的诊断信息

💡 **分批处理**
- 如果有多个目录需要还原
- 建议逐个还原，而不是同时进行

## 支持的操作系统

- ✅ Windows 10 (1903+)
- ✅ Windows 11
- ✅ Windows Server 2019+

## 相关文档

- [手动模式还原功能测试指南](./手动模式还原功能测试指南.md)
- [手动模式还原功能实现总结](./手动模式还原功能实现总结.md)
- [快速上手指南](./快速上手指南.md)

---

**祝您使用愉快！** 🎉

如有问题或建议，欢迎反馈。

