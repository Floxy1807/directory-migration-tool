# å¿«é€Ÿå‚è€ƒå¡ç‰‡

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3 æ­¥ï¼‰

### æ–¹å¼ 1: GUI ç‰ˆæœ¬ï¼ˆæ¨èæ–°æ‰‹ï¼‰

```powershell
# 1. æ„å»º
.\build.ps1

# 2. è¿è¡Œ
cd MoveWithSymlinkGUI\bin\x64\Release\net8.0-windows10.0.19041.0
.\MoveWithSymlinkGUI.exe
```

### æ–¹å¼ 2: PowerShell CLIï¼ˆæ¨èé«˜çº§ç”¨æˆ·ï¼‰

```powershell
# ç›´æ¥è¿è¡Œï¼ˆæ— éœ€æ„å»ºï¼‰
.\MoveWithSymlink.ps1 -Source "C:\æºç›®å½•" -Target "D:\ç›®æ ‡ç›®å½•"
```

---

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### æ„å»ºç›¸å…³

```powershell
# è¿˜åŸä¾èµ–
dotnet restore

# Debug æ„å»º
dotnet build -c Debug

# Release æ„å»º
dotnet build -c Release

# æ„å»ºç‰¹å®šå¹³å°
dotnet build -c Release /p:Platform=x64

# æ¸…ç†æ„å»ºè¾“å‡º
dotnet clean
```

### è¿è¡Œç›¸å…³

```powershell
# è¿è¡Œ GUIï¼ˆDebugï¼‰
cd MoveWithSymlinkGUI
dotnet run

# è¿è¡Œ GUIï¼ˆReleaseï¼‰
dotnet run -c Release

# ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆéœ€è¦å…ˆæ„å»ºï¼‰
.\MoveWithSymlinkGUI\bin\x64\Release\net8.0-windows10.0.19041.0\MoveWithSymlinkGUI.exe

# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼ˆæ¨èï¼‰
Start-Process -FilePath ".\MoveWithSymlinkGUI.exe" -Verb RunAs
```

### PowerShell CLI å‚æ•°

```powershell
# åŸºæœ¬ç”¨æ³•
.\MoveWithSymlink.ps1 -Source "æºç›®å½•" -Target "ç›®æ ‡ç›®å½•"

# å®Œæ•´å‚æ•°
.\MoveWithSymlink.ps1 `
    -Source "C:\è¦è¿ç§»çš„ç›®å½•" `
    -Target "D:\ç›®æ ‡ä½ç½®" `
    -LargeFileThresholdMB 2048 `
    -RobocopyThreads 16 `
    -SampleMilliseconds 500

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
.\MoveWithSymlink.ps1 -Source "..." -Target "..." | Tee-Object -FilePath migration.log
```

---

## ğŸ“ ç›®å½•ç»“æ„é€ŸæŸ¥

```
MoveWithSymlink/
â”œâ”€â”€ MoveWithSymlink.sln              # è§£å†³æ–¹æ¡ˆ
â”œâ”€â”€ build.ps1                        # ä¸€é”®æ„å»ºè„šæœ¬ â­
â”œâ”€â”€ MoveWithSymlink.ps1              # PowerShell CLI â­
â”‚
â”œâ”€â”€ MigrationCore/                   # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ Models/                      # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ MigrationConfig.cs
â”‚   â”‚   â”œâ”€â”€ FileStats.cs
â”‚   â”‚   â”œâ”€â”€ MigrationProgress.cs
â”‚   â”‚   â””â”€â”€ MigrationResult.cs
â”‚   â””â”€â”€ Services/                    # æœåŠ¡
â”‚       â”œâ”€â”€ MigrationService.cs      # æ ¸å¿ƒæœåŠ¡ â­
â”‚       â”œâ”€â”€ PathValidator.cs
â”‚       â”œâ”€â”€ FileStatsService.cs
â”‚       â””â”€â”€ SymbolicLinkHelper.cs
â”‚
â””â”€â”€ MoveWithSymlinkGUI/              # GUI åº”ç”¨
    â”œâ”€â”€ MainWindow.xaml              # ä¸»ç•Œé¢ â­
    â”œâ”€â”€ App.xaml                     # åº”ç”¨ç¨‹åº
    â””â”€â”€ ViewModels/
        â””â”€â”€ MainViewModel.cs         # è§†å›¾æ¨¡å‹ â­
```

---

## ğŸ¯ æ ¸å¿ƒç±»é€ŸæŸ¥

### MigrationServiceï¼ˆæ ¸å¿ƒæœåŠ¡ï¼‰

```csharp
var config = new MigrationConfig {
    SourcePath = "C:\\æºç›®å½•",
    TargetPath = "D:\\ç›®æ ‡ç›®å½•",
    LargeFileThresholdMB = 1024,
    RobocopyThreads = 8,
    SampleMilliseconds = 1000
};

var service = new MigrationService(config);

var progress = new Progress<MigrationProgress>(p => {
    Console.WriteLine($"{p.PercentComplete:F1}% - {p.Message}");
});

var logProgress = new Progress<string>(msg => {
    Console.WriteLine(msg);
});

var result = await service.ExecuteMigrationAsync(progress, logProgress);
```

### PathValidatorï¼ˆè·¯å¾„éªŒè¯ï¼‰

```csharp
// éªŒè¯æºè·¯å¾„
var (isValid, error, warning) = PathValidator.ValidateSourcePath("C:\\...");

// éªŒè¯ç›®æ ‡è·¯å¾„
var (isValid, error) = PathValidator.ValidateTargetPath("D:\\...");

// éªŒè¯è·¯å¾„å…³ç³»
var (isValid, error) = PathValidator.ValidatePathRelation(source, target);

// æ£€æŸ¥ç®¡ç†å‘˜æƒé™
bool isAdmin = PathValidator.IsAdministrator();

// æ£€æŸ¥ç£ç›˜ç©ºé—´
var (sufficient, available, required) = PathValidator.CheckDiskSpace(target, requiredBytes);
```

### FileStatsServiceï¼ˆæ–‡ä»¶ç»Ÿè®¡ï¼‰

```csharp
// æ‰«æç›®å½•
var stats = await FileStatsService.ScanDirectoryAsync(
    directoryPath,
    thresholdBytes,
    progress,
    cancellationToken
);

// è·å–ç›®å½•å¤§å°
long size = FileStatsService.GetDirectorySize(directoryPath);

// æ ¼å¼åŒ–å­—èŠ‚
string formatted = FileStatsService.FormatBytes(1073741824); // "1.00 GB"
```

### SymbolicLinkHelperï¼ˆç¬¦å·é“¾æ¥ï¼‰

```csharp
// åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆP/Invokeï¼‰
bool success = SymbolicLinkHelper.CreateDirectorySymbolicLink(link, target);

// åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆcmdï¼‰
bool success = SymbolicLinkHelper.CreateSymbolicLinkViaCmdAsync(link, target, out string error);

// æ£€æŸ¥æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥
bool isLink = SymbolicLinkHelper.IsSymbolicLink(path);
```

---

## ğŸ”§ å¸¸è§ä»»åŠ¡

### 1. æ·»åŠ æ–°çš„é˜»æ­¢ç›®å½•

ç¼–è¾‘ `MigrationCore/Services/PathValidator.cs`:

```csharp
private static readonly string[] BlockedPaths = new[]
{
    @"C:\Windows",
    @"C:\Program Files",
    @"C:\YourNewBlockedPath",  // â† æ·»åŠ è¿™é‡Œ
};
```

### 2. ä¿®æ”¹é»˜è®¤å‚æ•°

ç¼–è¾‘ `MigrationCore/Models/MigrationConfig.cs`:

```csharp
public int LargeFileThresholdMB { get; set; } = 2048;  // æ”¹ä¸º 2GB
public int RobocopyThreads { get; set; } = 16;         // æ”¹ä¸º 16 çº¿ç¨‹
```

### 3. è‡ªå®šä¹‰ UI ä¸»é¢˜

ç¼–è¾‘ `MoveWithSymlinkGUI/App.xaml`:

```xml
<Application.Resources>
    <ResourceDictionary>
        <SolidColorBrush x:Key="CustomAccentBrush" Color="#0078D4"/>
        <!-- æ·»åŠ è‡ªå®šä¹‰èµ„æº -->
    </ResourceDictionary>
</Application.Resources>
```

### 4. æ·»åŠ æ—¥å¿—åˆ°æ–‡ä»¶

åœ¨ `MigrationService.cs` ä¸­æ·»åŠ :

```csharp
private void LogToFile(string message)
{
    File.AppendAllText("migration.log", $"[{DateTime.Now}] {message}\n");
}
```

---

## âš ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ— æ³•æ„å»º

```powershell
# æ£€æŸ¥ .NET ç‰ˆæœ¬
dotnet --version  # åº”è¯¥æ˜¯ 8.0.x

# æ¸…ç†å¹¶é‡æ–°æ„å»º
dotnet clean
dotnet restore
dotnet build
```

### é—®é¢˜ 2: GUI å¯åŠ¨å¤±è´¥

```powershell
# æ£€æŸ¥æ˜¯å¦æœ‰ Windows App SDK
winget list Microsoft.WindowsAppRuntime

# å®‰è£…/æ›´æ–° Windows App SDK
winget install Microsoft.WindowsAppRuntime.1.5
```

### é—®é¢˜ 3: ç¬¦å·é“¾æ¥åˆ›å»ºå¤±è´¥

```powershell
# æ£€æŸ¥æ˜¯å¦æœ‰ç®¡ç†å‘˜æƒé™
[Security.Principal.WindowsPrincipal]::new([Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

# å¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼ˆè®¾ç½® â†’ éšç§å’Œå®‰å…¨æ€§ â†’ å¼€å‘è€…é€‰é¡¹ï¼‰
```

### é—®é¢˜ 4: robocopy é€Ÿåº¦æ…¢

```powershell
# å¢åŠ çº¿ç¨‹æ•°ï¼ˆPowerShell CLIï¼‰
.\MoveWithSymlink.ps1 -Source "..." -Target "..." -RobocopyThreads 32

# æˆ–åœ¨ GUI ä¸­è®¾ç½®æ›´å¤§çš„çº¿ç¨‹æ•°ï¼ˆå¦‚ 16ã€32ï¼‰
```

---

## ğŸ“Š æ€§èƒ½è°ƒä¼˜

### æ¨èå‚æ•°ï¼ˆæ ¹æ®åœºæ™¯ï¼‰

| åœºæ™¯ | çº¿ç¨‹æ•° | é‡‡æ ·é—´éš” | è¯´æ˜ |
|------|-------|---------|------|
| **å°æ–‡ä»¶å¤š** | 16-32 | 500ms | å……åˆ†åˆ©ç”¨å¹¶è¡Œ |
| **å¤§æ–‡ä»¶å°‘** | 4-8 | 2000ms | å‡å°‘å¼€é”€ |
| **SSD â†’ SSD** | 16-32 | 1000ms | é«˜é€Ÿå¤åˆ¶ |
| **HDD â†’ HDD** | 4-8 | 1000ms | é¿å…ç£å¤´ç«äº‰ |
| **ç½‘ç»œé©±åŠ¨å™¨** | 4 | 2000ms | å‡å°‘ç½‘ç»œå‹åŠ› |

### Robocopy å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ |
|------|------|
| `/MIR` | é•œåƒå¤åˆ¶ï¼ˆåˆ é™¤ç›®æ ‡å¤šä½™æ–‡ä»¶ï¼‰ |
| `/COPYALL` | å¤åˆ¶æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ï¼ˆæƒé™ã€æ‰€æœ‰è€…ã€å®¡æ ¸ï¼‰ |
| `/DCOPY:DAT` | å¤åˆ¶ç›®å½•æ•°æ®ã€å±æ€§ã€æ—¶é—´æˆ³ |
| `/R:0` | å¤±è´¥é‡è¯• 0 æ¬¡ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰ |
| `/W:0` | é‡è¯•ç­‰å¾… 0 ç§’ |
| `/XJ` | æ’é™¤äº¤æ¥ç‚¹ï¼ˆç¬¦å·é“¾æ¥ï¼‰ |
| `/NFL /NDL /NP` | ä¸åˆ—å‡ºæ–‡ä»¶/ç›®å½•/è¿›åº¦ï¼ˆå‡å°‘è¾“å‡ºï¼‰ |
| `/MT:8` | 8 çº¿ç¨‹å¹¶è¡Œ |

---

## ğŸ“ å­¦ä¹ èµ„æº

### æŠ€æœ¯æ–‡æ¡£

- [.NET 8 æ–‡æ¡£](https://learn.microsoft.com/dotnet/core/whats-new/dotnet-8)
- [WinUI 3 æ–‡æ¡£](https://learn.microsoft.com/windows/apps/winui/winui3/)
- [CommunityToolkit.Mvvm](https://learn.microsoft.com/dotnet/communitytoolkit/mvvm/)
- [Robocopy æ–‡æ¡£](https://learn.microsoft.com/windows-server/administration/windows-commands/robocopy)

### ç›¸å…³å‘½ä»¤

```powershell
# æŸ¥çœ‹ç¬¦å·é“¾æ¥
dir /AL

# åˆ é™¤ç¬¦å·é“¾æ¥ï¼ˆä¸ä¼šåˆ é™¤ç›®æ ‡ï¼‰
Remove-Item -Path "é“¾æ¥è·¯å¾„" -Force

# æ‰‹åŠ¨åˆ›å»ºç¬¦å·é“¾æ¥
cmd /c mklink /D "é“¾æ¥" "ç›®æ ‡"

# æŸ¥çœ‹æ–‡ä»¶å¤¹å±æ€§
Get-Item -Path "è·¯å¾„" | Select-Object Attributes

# æ£€æŸ¥é‡è§£æç‚¹
(Get-Item "è·¯å¾„").Attributes -band [System.IO.FileAttributes]::ReparsePoint
```

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹å®Œæ•´æ–‡æ¡£

- **README.md** - è‹±æ–‡é¡¹ç›®è¯´æ˜
- **ä½¿ç”¨è¯´æ˜.md** - è¯¦ç»†ä¸­æ–‡æ•™ç¨‹
- **é¡¹ç›®ç»“æ„.md** - æ¶æ„è¯´æ˜
- **å®Œæˆè¯´æ˜.md** - å®ç°æ€»ç»“

### PowerShell å¸®åŠ©

```powershell
# æŸ¥çœ‹è„šæœ¬å¸®åŠ©
Get-Help .\MoveWithSymlink.ps1 -Detailed

# æŸ¥çœ‹å‚æ•°è¯´æ˜
Get-Help .\MoveWithSymlink.ps1 -Parameter Source
```

---

## ğŸ¯ ä¸€é”®å‘½ä»¤æ±‡æ€»

```powershell
# === æ„å»ºå’Œè¿è¡Œ ===
.\build.ps1                                    # ä¸€é”®æ„å»º
cd MoveWithSymlinkGUI && dotnet run -c Release # è¿è¡Œ GUI

# === PowerShell CLI ===
.\MoveWithSymlink.ps1 -Source "C:\Src" -Target "D:\Dst"

# === é«˜çº§ CLI ===
.\MoveWithSymlink.ps1 `
    -Source "C:\Src" `
    -Target "D:\Dst" `
    -LargeFileThresholdMB 2048 `
    -RobocopyThreads 16 `
    -SampleMilliseconds 500 `
    | Tee-Object migration.log

# === æ£€æŸ¥ç¯å¢ƒ ===
dotnet --version                               # .NET ç‰ˆæœ¬
winver                                         # Windows ç‰ˆæœ¬
[Security.Principal.WindowsIdentity]::GetCurrent().Name  # å½“å‰ç”¨æˆ·
```

---

**æç¤º**: å°†æ­¤æ–‡ä»¶ä¿å­˜ä¸ºä¹¦ç­¾ï¼Œéšæ—¶æŸ¥é˜…ï¼ ğŸ“Œ

